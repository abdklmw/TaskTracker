document.addEventListener("DOMContentLoaded",function(){function n(n,t,i){if(n.value&&t.value){const r=new Date(n.value),u=new Date(t.value);if(!isNaN(r)&&!isNaN(u)&&u>r){const n=u-r,t=n/36e5;i.value=t.toFixed(2)}else i.value=""}else i.value=""}function e(){const n=document.querySelectorAll(".hours-spent");n.forEach(n=>{const t=new Date(n.dataset.startUtc),i=n.dataset.timeEntryId;if(isNaN(t))console.warn(`Invalid start time for time entry ${i}`),n.textContent="N/A";else{const i=t.getTime()+userTimezoneOffset*6e4,r=Date.now(),u=r-i,f=u/36e5,e=Math.ceil(f*4)/4;n.textContent=e.toFixed(2)}})}function u(n,t){const i=$(n).val();i&&i!=="0"?$.ajax({url:"/TimeEntries/GetProjectsByClient",type:"GET",data:{clientId:i},success:function(n){$(t).empty();$(t).append('<option value="0">Select Project<\/option>');n.forEach(n=>{$(t).append(`<option value="${n.ProjectID}">${n.Name}</option>`)})},error:function(n,i,r){console.error("Error fetching projects:",r);$(t).empty();$(t).append('<option value="0">Select Project<\/option>')}}):($(t).empty(),$(t).append('<option value="0">Select Project<\/option>'))}$("#create-new-btn").click(function(){$("#create-form").css("display","block");$("#create-new-btn").css("display","none")});$(".cancel-create-btn").click(function(){$("#create-form").css("display","none");$("#create-new-btn").css("display","")});$(".edit-btn").click(function(){let n=$(this).data("id");$("#display-row-"+n).css("display","none");$("#edit-row-"+n).css("display","block")});$(".cancel-btn").click(function(){let n=$(this).data("id");$("#edit-row-"+n).css("display","none");$("#display-row-"+n).css("display","block")});$(".alert-success").delay(3e3).fadeOut(1e3,function(){$(this).alert("close")});const t=document.querySelector('#create-form input[name="StartDateTime"]'),i=document.querySelector('#create-form input[name="EndDateTime"]'),r=document.querySelector('#create-form input[name="HoursSpent"]');t&&i&&r&&(t.addEventListener("input",()=>n(t,i,r)),i.addEventListener("input",()=>n(t,i,r)));document.querySelectorAll(".edit-mode").forEach(t=>{const i=t.querySelector('input[name="StartDateTime"]'),r=t.querySelector('input[name="EndDateTime"]'),u=t.querySelector('input[name="HoursSpent"]');i&&r&&u&&(i.addEventListener("input",()=>n(i,r,u)),r.addEventListener("input",()=>n(i,r,u)))});$(".start-timer-btn").click(function(n){n.preventDefault();const r=document.getElementById("create-time-entry-form"),t=document.querySelector('#create-form input[name="StartDateTime"]'),i=document.getElementById("form-action");try{t&&t.removeAttribute("required");i&&(i.value="StartTimer");r.submit()}catch(u){console.error("Error submitting Start Timer form:",u)}});e();setInterval(e,6e4);const f=$('#create-form select[name="ClientID"]'),o=$('#create-form select[name="ProjectID"]');if(f.length&&o.length)f.on("change",function(){u(f,o)});document.querySelectorAll(".edit-mode").forEach(n=>{const t=n.querySelector('select[name="ClientID"]'),i=n.querySelector('select[name="ProjectID"]');if(t&&i){$(t).on("change",function(){u(t,i)});$(t).val()&&$(t).val()!=="0"&&u(t,i)}})});